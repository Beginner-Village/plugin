# ğŸš€ ARM Mac ä¸Šæ„å»º x86 é•œåƒæŒ‡å—

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•åœ¨ ARM Mac ä¸Šæ„å»ºå’Œè¿è¡Œ x86/amd64 æ¶æ„çš„ HiAgent Plugin Runtime é•œåƒã€‚

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- éœ€è¦åœ¨ x86 æœåŠ¡å™¨ä¸Šéƒ¨ç½²
- ç¡®ä¿ä¸ x86 ç¯å¢ƒçš„å…¼å®¹æ€§
- å¼€å‘å’Œæµ‹è¯•è·¨å¹³å°éƒ¨ç½²
- æ„å»ºé€šç”¨é•œåƒ

## ğŸ”§ å‰ç½®æ¡ä»¶

### 1. å¯ç”¨ Docker Buildx

Docker Buildx æ˜¯ Docker çš„å¤šå¹³å°æ„å»ºå·¥å…·ï¼Œé¦–æ¬¡ä½¿ç”¨éœ€è¦è®¾ç½®ï¼š

```bash
# ä¸€é”®è®¾ç½® Buildx (ä»…éœ€è¿è¡Œä¸€æ¬¡)
make setup-buildx

# æˆ–æ‰‹åŠ¨è®¾ç½®
docker buildx create --name multiarch --driver docker-container --use
docker buildx inspect --bootstrap
```

### 2. éªŒè¯ Buildx çŠ¶æ€

```bash
# æŸ¥çœ‹å¯ç”¨çš„æ„å»ºå™¨
docker buildx ls

# æŸ¥çœ‹æ”¯æŒçš„å¹³å°
docker buildx inspect --bootstrap
```

## ğŸ”¨ æ„å»ºé€‰é¡¹

### 1. æœ¬åœ°æ¶æ„æ„å»º (ARM)

```bash
# æ„å»ºæœ¬åœ° ARM æ¶æ„é•œåƒ
make build
```

### 2. x86 æ¶æ„æ„å»º

```bash
# æ„å»º x86/amd64 æ¶æ„é•œåƒ
make build-x86
```

è¿™ä¼šåˆ›å»ºåä¸º `hiagent-plugin-runtime:latest-amd64` çš„é•œåƒã€‚

### 3. å¤šå¹³å°æ„å»º

```bash
# æ„å»ºåŒæ—¶æ”¯æŒ x86 å’Œ ARM çš„é•œåƒ
make build-multi
```

### 4. æ„å»ºå¹¶æ¨é€åˆ°ä»“åº“

```bash
# æ„å»ºå¤šå¹³å°é•œåƒå¹¶æ¨é€åˆ° Docker Hub
make build-push
```

## ğŸš€ è¿è¡Œ x86 é•œåƒ

### 1. å¯åŠ¨ x86 æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨ x86 æ¶æ„çš„æœåŠ¡
make up-x86
```

è¿™ä¼šä½¿ç”¨ `docker-compose-x86.yml` é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­ï¼š
- æ‰€æœ‰å®¹å™¨å¼ºåˆ¶ä½¿ç”¨ `linux/amd64` å¹³å°
- Redis ç«¯å£æ˜ å°„åˆ° `26379` é¿å…å†²çª
- ä½¿ç”¨ `hiagent-plugin-runtime:latest-amd64` é•œåƒ

### 2. ç®¡ç† x86 æœåŠ¡

```bash
# æŸ¥çœ‹ x86 æœåŠ¡çŠ¶æ€
make status-x86

# åœæ­¢ x86 æœåŠ¡
make down-x86

# é‡å¯ x86 æœåŠ¡
make restart-x86
```

## ğŸ“Š æ€§èƒ½æ³¨æ„äº‹é¡¹

### ARM Mac è¿è¡Œ x86 é•œåƒçš„å½±å“

1. **æ€§èƒ½å¼€é”€**: ARM Mac é€šè¿‡ Rosetta 2 æ¨¡æ‹Ÿè¿è¡Œ x86ï¼Œæ€§èƒ½ä¼šæœ‰æ‰€ä¸‹é™
2. **å†…å­˜ä½¿ç”¨**: æ¨¡æ‹Ÿå±‚ä¼šå¢åŠ å†…å­˜ä½¿ç”¨
3. **å¯åŠ¨æ—¶é—´**: x86 å®¹å™¨å¯åŠ¨æ—¶é—´ä¼šæ›´é•¿

### æ¨èä½¿ç”¨åœºæ™¯

- **å¼€å‘æµ‹è¯•**: âœ… é€‚åˆå¼€å‘å’Œæµ‹è¯•è·¨å¹³å°å…¼å®¹æ€§
- **ç”Ÿäº§éƒ¨ç½²**: âŒ å»ºè®®åœ¨ç›®æ ‡æ¶æ„ä¸Šç›´æ¥æ„å»º
- **CI/CD**: âœ… é€‚åˆåœ¨ CI/CD ä¸­æ„å»ºå¤šå¹³å°é•œåƒ

## ğŸ”„ æœ€ä½³å®è·µ

### 1. å¼€å‘æµç¨‹

```bash
# 1. æœ¬åœ°å¼€å‘ä½¿ç”¨ ARM é•œåƒ (å¿«é€Ÿ)
make dev

# 2. æµ‹è¯• x86 å…¼å®¹æ€§
make build-x86
make up-x86

# 3. ç”Ÿäº§éƒ¨ç½²å‰æ„å»ºå¤šå¹³å°é•œåƒ
make build-multi
```

### 2. CI/CD é›†æˆ

```bash
# åœ¨ CI/CD ä¸­æ„å»ºå¹¶æ¨é€å¤šå¹³å°é•œåƒ
make setup-buildx
make build-push
```

### 3. æ¶æ„é€‰æ‹©ç­–ç•¥

| åœºæ™¯ | æ¨èæ¶æ„ | å‘½ä»¤ |
|------|----------|------|
| æœ¬åœ°å¼€å‘ | ARM (åŸç”Ÿ) | `make build && make up` |
| å…¼å®¹æ€§æµ‹è¯• | x86 | `make build-x86 && make up-x86` |
| ç”Ÿäº§éƒ¨ç½² | ç›®æ ‡æ¶æ„ | `make build-multi` |

## ğŸ› æ•…éšœæ’é™¤

### 1. Buildx æœªå®‰è£…

**é”™è¯¯**: `docker: 'buildx' is not a docker command`

**è§£å†³**:
```bash
# æ›´æ–° Docker Desktop åˆ°æœ€æ–°ç‰ˆæœ¬
# æˆ–æ‰‹åŠ¨å¯ç”¨å®éªŒæ€§åŠŸèƒ½
```

### 2. å¹³å°ä¸æ”¯æŒ

**é”™è¯¯**: `platform not supported`

**è§£å†³**:
```bash
# é‡æ–°è®¾ç½® Buildx
make setup-buildx
```

### 3. x86 é•œåƒè¿è¡Œç¼“æ…¢

**åŸå› **: ARM Mac æ¨¡æ‹Ÿè¿è¡Œ x86

**è§£å†³**:
- å¼€å‘æ—¶ä½¿ç”¨ ARM é•œåƒ: `make up`
- ä»…åœ¨å¿…è¦æ—¶æµ‹è¯• x86: `make up-x86`

### 4. ç«¯å£å†²çª

**é”™è¯¯**: `port already in use`

**è§£å†³**:
```bash
# x86 é…ç½®ä½¿ç”¨ä¸åŒç«¯å£
# Redis: 26379 (é»˜è®¤ 6379)
# API: 8000 (å¦‚éœ€ä¿®æ”¹è¯·ç¼–è¾‘ docker-compose-x86.yml)
```

## ğŸ“‹ å®Œæ•´å‘½ä»¤åˆ—è¡¨

### æ„å»ºå‘½ä»¤
```bash
make build         # æœ¬åœ°æ¶æ„ (ARM)
make build-x86     # x86 æ¶æ„
make build-multi   # å¤šå¹³å°
make build-push    # æ„å»ºå¹¶æ¨é€
make setup-buildx  # è®¾ç½® Buildx
```

### è¿è¡Œå‘½ä»¤
```bash
make up            # ARM æœåŠ¡
make up-x86        # x86 æœåŠ¡
make down          # åœæ­¢ ARM æœåŠ¡
make down-x86      # åœæ­¢ x86 æœåŠ¡
make restart-x86   # é‡å¯ x86 æœåŠ¡
```

### ç›‘æ§å‘½ä»¤
```bash
make status        # ARM æœåŠ¡çŠ¶æ€
make status-x86    # x86 æœåŠ¡çŠ¶æ€
make logs          # æŸ¥çœ‹æ—¥å¿—
make test          # æµ‹è¯•è¿é€šæ€§
```

## ğŸ¯ æ€»ç»“

é€šè¿‡è¿™ä¸ªè·¨å¹³å°æ„å»ºæ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥ï¼š

- âœ… åœ¨ ARM Mac ä¸Šæ„å»º x86 é•œåƒ
- âœ… æµ‹è¯•è·¨å¹³å°å…¼å®¹æ€§
- âœ… æ”¯æŒå¤šæ¶æ„éƒ¨ç½²
- âœ… ä¿æŒå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸€è‡´æ€§

**æ¨èå·¥ä½œæµç¨‹**:
1. æœ¬åœ°å¼€å‘: `make up` (ARM, å¿«é€Ÿ)
2. å…¼å®¹æ€§æµ‹è¯•: `make up-x86` (x86, éªŒè¯)
3. ç”Ÿäº§éƒ¨ç½²: `make build-multi` (å¤šå¹³å°)